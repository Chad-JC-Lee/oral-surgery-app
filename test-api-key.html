<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>API Key æ¸¬è©¦é é¢</title>
  <script src="./api-key-final.js"></script>
  <script src="./api-key-urgent.js"></script>
  <script defer="defer" src="./api-key-simple.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 2rem;
    }
    .status {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      font-weight: 500;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin: 0.5rem;
      transition: background-color 0.3s;
    }
    .button:hover {
      background: #0056b3;
    }
    .button.success {
      background: #28a745;
    }
    .button.success:hover {
      background: #218838;
    }
    .button.danger {
      background: #dc3545;
    }
    .button.danger:hover {
      background: #c82333;
    }
    .output {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 6px;
      margin: 1rem 0;
      border: 1px solid #e9ecef;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
    }
    .test-section {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      margin: 1rem 0;
      border: 1px solid #e9ecef;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ API Key åŸ·è¡Œæ¸¬è©¦</h1>
    
    <div id="status" class="status">
      æ­£åœ¨æª¢æŸ¥ API Key ç‹€æ…‹...
    </div>
    
    <div class="test-section">
      <h3>ğŸ§ª åŸºæœ¬æ¸¬è©¦</h3>
      <button class="button" onclick="testBasic()">åŸºæœ¬åŠŸèƒ½æ¸¬è©¦</button>
      <button class="button success" onclick="testGetApiKey()">æ¸¬è©¦ getApiKey()</button>
      <button class="button" onclick="testLocalStorage()">æ¸¬è©¦ localStorage</button>
      <div id="basicOutput" class="output">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
    </div>
    
    <div class="test-section">
      <h3>ğŸ”§ ä¿®å¾©æ¸¬è©¦</h3>
      <button class="button success" onclick="testFinalFix()">æ¸¬è©¦æœ€çµ‚ä¿®å¾©</button>
      <button class="button" onclick="testUrgentFix()">æ¸¬è©¦ç·Šæ€¥ä¿®å¾©</button>
      <button class="button" onclick="testSimpleFix()">æ¸¬è©¦ç°¡å–®ä¿®å¾©</button>
      <div id="fixOutput" class="output">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
    </div>
    
    <div class="test-section">
      <h3>ğŸš¨ éŒ¯èª¤æ¨¡æ“¬æ¸¬è©¦</h3>
      <button class="button danger" onclick="simulateError()">æ¨¡æ“¬ API key éŒ¯èª¤</button>
      <button class="button" onclick="simulateAppCheck()">æ¨¡æ“¬æ‡‰ç”¨ç¨‹å¼æª¢æŸ¥</button>
      <button class="button" onclick="testErrorInterception()">æ¸¬è©¦éŒ¯èª¤æ””æˆª</button>
      <div id="errorOutput" class="output">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
    </div>
    
    <div class="test-section">
      <h3>ğŸ“Š è©³ç´°ç‹€æ…‹</h3>
      <button class="button" onclick="showDetailedStatus()">é¡¯ç¤ºè©³ç´°ç‹€æ…‹</button>
      <button class="button" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰æ¸¬è©¦</button>
      <div id="detailedOutput" class="output">é»æ“ŠæŒ‰éˆ•æŸ¥çœ‹è©³ç´°ç‹€æ…‹...</div>
    </div>
  </div>

  <script>
    // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
    function updateStatus() {
      const apiKey = localStorage.getItem('google_ai_api_key') || '';
      const statusDiv = document.getElementById('status');
      const isValid = apiKey && apiKey.length >= 30;
      
      if (isValid) {
        statusDiv.className = 'status success';
        statusDiv.innerHTML = `âœ… API Key å·²è¨­ç½®ä¸”æ ¼å¼æ­£ç¢º (${apiKey.length} å€‹å­—ç¬¦)`;
      } else {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = `âŒ API Key æœªè¨­ç½®æˆ–æ ¼å¼ä¸æ­£ç¢º (ç•¶å‰: ${apiKey.length} å€‹å­—ç¬¦)`;
      }
    }
    
    // åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
    function testBasic() {
      const output = document.getElementById('basicOutput');
      let result = `ğŸ” åŸºæœ¬åŠŸèƒ½æ¸¬è©¦:\n`;
      
      // æª¢æŸ¥ localStorage
      const apiKey = localStorage.getItem('google_ai_api_key');
      result += `- localStorage ä¸­çš„ key: ${apiKey ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      result += `- key é•·åº¦: ${apiKey ? apiKey.length : 0} å€‹å­—ç¬¦\n`;
      result += `- æ ¼å¼é©—è­‰: ${apiKey && apiKey.length >= 30 ? 'é€šé' : 'å¤±æ•—'}\n`;
      
      // æª¢æŸ¥å…¨å±€å‡½æ•¸
      result += `- window.getApiKey: ${typeof window.getApiKey === 'function' ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      result += `- window.finalApiKeyFix: ${typeof window.finalApiKeyFix === 'function' ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      result += `- window.urgentApiKeyFix: ${typeof window.urgentApiKeyFix === 'function' ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      
      output.textContent = result;
      updateStatus();
    }
    
    // æ¸¬è©¦ getApiKey å‡½æ•¸
    function testGetApiKey() {
      const output = document.getElementById('basicOutput');
      let result = `ğŸ” getApiKey() å‡½æ•¸æ¸¬è©¦:\n`;
      
      if (typeof window.getApiKey === 'function') {
        try {
          const apiKey = window.getApiKey();
          result += `- å‡½æ•¸åŸ·è¡Œ: æˆåŠŸ\n`;
          result += `- è¿”å›å€¼: ${apiKey ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}\n`;
          result += `- è¿”å›å€¼é•·åº¦: ${apiKey ? apiKey.length : 0} å€‹å­—ç¬¦\n`;
          
          if (apiKey) {
            result += `- è¿”å›å€¼å‰10å€‹å­—ç¬¦: ${apiKey.substring(0, 10)}...\n`;
          }
        } catch (error) {
          result += `- å‡½æ•¸åŸ·è¡Œ: å¤±æ•—\n`;
          result += `- éŒ¯èª¤: ${error.message}\n`;
        }
      } else {
        result += `- å‡½æ•¸å­˜åœ¨: å¦\n`;
      }
      
      output.textContent = result;
    }
    
    // æ¸¬è©¦ localStorage
    function testLocalStorage() {
      const output = document.getElementById('basicOutput');
      let result = `ğŸ” localStorage æ¸¬è©¦:\n`;
      
      const apiKey = localStorage.getItem('google_ai_api_key');
      result += `- ç›´æ¥è®€å–: ${apiKey ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
      result += `- å€¼: ${apiKey ? apiKey.substring(0, 10) + '...' : 'ç„¡'}\n`;
      result += `- é•·åº¦: ${apiKey ? apiKey.length : 0} å€‹å­—ç¬¦\n`;
      
      // æ¸¬è©¦è¨­ç½®
      const testKey = 'test-key-' + Date.now();
      localStorage.setItem('test_key', testKey);
      const retrieved = localStorage.getItem('test_key');
      result += `- è¨­ç½®æ¸¬è©¦: ${retrieved === testKey ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
      localStorage.removeItem('test_key');
      
      output.textContent = result;
    }
    
    // æ¸¬è©¦æœ€çµ‚ä¿®å¾©
    function testFinalFix() {
      const output = document.getElementById('fixOutput');
      let result = `ğŸ”§ æœ€çµ‚ä¿®å¾©æ¸¬è©¦:\n`;
      
      if (window.finalApiKeyFix) {
        try {
          const success = window.finalApiKeyFix();
          result += `- å‡½æ•¸åŸ·è¡Œ: æˆåŠŸ\n`;
          result += `- ä¿®å¾©çµæœ: ${success ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
        } catch (error) {
          result += `- å‡½æ•¸åŸ·è¡Œ: å¤±æ•—\n`;
          result += `- éŒ¯èª¤: ${error.message}\n`;
        }
      } else {
        result += `- å‡½æ•¸å­˜åœ¨: å¦\n`;
      }
      
      output.textContent = result;
    }
    
    // æ¸¬è©¦ç·Šæ€¥ä¿®å¾©
    function testUrgentFix() {
      const output = document.getElementById('fixOutput');
      let result = `ğŸ”§ ç·Šæ€¥ä¿®å¾©æ¸¬è©¦:\n`;
      
      if (window.urgentApiKeyFix) {
        try {
          const success = window.urgentApiKeyFix();
          result += `- å‡½æ•¸åŸ·è¡Œ: æˆåŠŸ\n`;
          result += `- ä¿®å¾©çµæœ: ${success ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
        } catch (error) {
          result += `- å‡½æ•¸åŸ·è¡Œ: å¤±æ•—\n`;
          result += `- éŒ¯èª¤: ${error.message}\n`;
        }
      } else {
        result += `- å‡½æ•¸å­˜åœ¨: å¦\n`;
      }
      
      output.textContent = result;
    }
    
    // æ¸¬è©¦ç°¡å–®ä¿®å¾©
    function testSimpleFix() {
      const output = document.getElementById('fixOutput');
      let result = `ğŸ”§ ç°¡å–®ä¿®å¾©æ¸¬è©¦:\n`;
      
      if (window.simpleApiKeyFix) {
        try {
          const isValid = window.simpleApiKeyFix.check();
          result += `- æª¢æŸ¥å‡½æ•¸: å­˜åœ¨\n`;
          result += `- æª¢æŸ¥çµæœ: ${isValid ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}\n`;
          
          const apiKey = window.simpleApiKeyFix.get();
          result += `- ç²å–å‡½æ•¸: å­˜åœ¨\n`;
          result += `- ç²å–çµæœ: ${apiKey ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
        } catch (error) {
          result += `- å‡½æ•¸åŸ·è¡Œ: å¤±æ•—\n`;
          result += `- éŒ¯èª¤: ${error.message}\n`;
        }
      } else {
        result += `- å‡½æ•¸å­˜åœ¨: å¦\n`;
      }
      
      output.textContent = result;
    }
    
    // æ¨¡æ“¬éŒ¯èª¤
    function simulateError() {
      const output = document.getElementById('errorOutput');
      let result = `ğŸš¨ éŒ¯èª¤æ¨¡æ“¬æ¸¬è©¦:\n`;
      
      // æ¨¡æ“¬ console.error
      console.error('API keyæœªè¨­ç½®ï¼Œè«‹åœ¨é–‹ç™¼ç’°å¢ƒä¸­è¨­ç½®API key');
      result += `- å·²è§¸ç™¼ console.error\n`;
      
      // æ¨¡æ“¬éŒ¯èª¤æ‹‹å‡º
      try {
        throw new Error('API keyæœªè¨­ç½®ï¼Œè«‹åœ¨é–‹ç™¼ç’°å¢ƒä¸­è¨­ç½®API key');
      } catch (error) {
        result += `- å·²æ‹‹å‡ºéŒ¯èª¤: ${error.message}\n`;
      }
      
      result += `- æª¢æŸ¥ä¿®å¾©è…³æœ¬æ˜¯å¦æ””æˆªäº†é€™äº›éŒ¯èª¤\n`;
      
      output.textContent = result;
    }
    
    // æ¨¡æ“¬æ‡‰ç”¨ç¨‹å¼æª¢æŸ¥
    function simulateAppCheck() {
      const output = document.getElementById('errorOutput');
      let result = `ğŸ” æ‡‰ç”¨ç¨‹å¼æª¢æŸ¥æ¨¡æ“¬:\n`;
      
      // æ¨¡æ“¬æ‡‰ç”¨ç¨‹å¼çš„æª¢æŸ¥é‚è¼¯
      const apiKey = window.getApiKey ? window.getApiKey() : null;
      result += `- èª¿ç”¨ getApiKey(): ${apiKey ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
      result += `- è¿”å›å€¼: ${apiKey ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}\n`;
      result += `- è¿”å›å€¼é•·åº¦: ${apiKey ? apiKey.length : 0} å€‹å­—ç¬¦\n`;
      
      if (apiKey) {
        result += `- è¿”å›å€¼å‰10å€‹å­—ç¬¦: ${apiKey.substring(0, 10)}...\n`;
      }
      
      output.textContent = result;
    }
    
    // æ¸¬è©¦éŒ¯èª¤æ””æˆª
    function testErrorInterception() {
      const output = document.getElementById('errorOutput');
      let result = `ğŸš¨ éŒ¯èª¤æ””æˆªæ¸¬è©¦:\n`;
      
      // æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤æ””æˆª
      const originalError = console.error;
      let errorIntercepted = false;
      
      console.error = function(...args) {
        const message = args.join(' ');
        if (message.includes('API keyæœªè¨­ç½®')) {
          errorIntercepted = true;
          return; // ä¸é¡¯ç¤ºéŒ¯èª¤
        }
        originalError.apply(console, args);
      };
      
      // è§¸ç™¼éŒ¯èª¤
      console.error('API keyæœªè¨­ç½®ï¼Œè«‹åœ¨é–‹ç™¼ç’°å¢ƒä¸­è¨­ç½®API key');
      
      // æ¢å¾©åŸå§‹ console.error
      console.error = originalError;
      
      result += `- éŒ¯èª¤æ””æˆª: ${errorIntercepted ? 'æˆåŠŸ' : 'å¤±æ•—'}\n`;
      
      output.textContent = result;
    }
    
    // é¡¯ç¤ºè©³ç´°ç‹€æ…‹
    function showDetailedStatus() {
      const output = document.getElementById('detailedOutput');
      let result = `ğŸ“Š è©³ç´°ç‹€æ…‹å ±å‘Š:\n`;
      
      // API key ç‹€æ…‹
      const apiKey = localStorage.getItem('google_ai_api_key');
      result += `API Key ç‹€æ…‹:\n`;
      result += `- å­˜åœ¨: ${apiKey ? 'æ˜¯' : 'å¦'}\n`;
      result += `- é•·åº¦: ${apiKey ? apiKey.length : 0} å€‹å­—ç¬¦\n`;
      result += `- æ ¼å¼: ${apiKey && apiKey.length >= 30 ? 'æ­£ç¢º' : 'éŒ¯èª¤'}\n`;
      
      // å‡½æ•¸ç‹€æ…‹
      result += `\nå‡½æ•¸ç‹€æ…‹:\n`;
      result += `- getApiKey: ${typeof window.getApiKey === 'function' ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      result += `- finalApiKeyFix: ${typeof window.finalApiKeyFix === 'function' ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      result += `- urgentApiKeyFix: ${typeof window.urgentApiKeyFix === 'function' ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      result += `- simpleApiKeyFix: ${window.simpleApiKeyFix ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      
      // é é¢ç‹€æ…‹
      result += `\né é¢ç‹€æ…‹:\n`;
      result += `- DOM è¼‰å…¥: ${document.readyState}\n`;
      result += `- body å­˜åœ¨: ${document.body ? 'æ˜¯' : 'å¦'}\n`;
      result += `- root å…ƒç´ : ${document.querySelector('#root') ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}\n`;
      
      output.textContent = result;
    }
    
    // æ¸…é™¤æ‰€æœ‰æ¸¬è©¦
    function clearAll() {
      document.getElementById('basicOutput').textContent = 'å·²æ¸…é™¤...';
      document.getElementById('fixOutput').textContent = 'å·²æ¸…é™¤...';
      document.getElementById('errorOutput').textContent = 'å·²æ¸…é™¤...';
      document.getElementById('detailedOutput').textContent = 'å·²æ¸…é™¤...';
    }
    
    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      updateStatus();
      console.log('ğŸ§ª API Key æ¸¬è©¦é é¢å·²è¼‰å…¥');
    });
  </script>
</body>
</html>
